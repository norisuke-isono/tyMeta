@page "{handler?}"
@model Web.Pages_Specification.EditModel

@{
    ViewData["Title"] = "明細入力";
}

<h4>明細入力</h4>
<h5>@Model.SpecificationViewModel.AirDate.ToString("yyyy/MM/dd") 放送　@Model.SpecificationViewModel.TvProgramName</h5>
<hr />

<form method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="card">
        <h5 class="card-header">基本情報</h5>
        <div class="card-body">
            <div class="form-group row">
                <label asp-for="SpecificationViewModel.CornerName" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="SpecificationViewModel.CornerName" class="form-control" readonly />
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="SpecificationViewModel.Director" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="SpecificationViewModel.Director" class="form-control" />
                </div>
                <span asp-validation-for="SpecificationViewModel.Director" class="text-danger"></span>
            </div>
            <div class="form-group row">
                <label asp-for="SpecificationViewModel.Desk" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-4">
                    <input asp-for="SpecificationViewModel.Desk" class="form-control" />
                </div>
                <span asp-validation-for="SpecificationViewModel.Desk" class="text-danger"></span>
            </div>      
            <div class="form-group row">
                <label asp-for="SpecificationViewModel.Title" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-10">
                    <input asp-for="SpecificationViewModel.Title" class="form-control" />
                </div>
                <span asp-validation-for="SpecificationViewModel.Title" class="text-danger"></span>
            </div>
            <div class="form-group row">
                <label asp-for="SpecificationViewModel.Text" class="col-sm-2 col-form-label"></label>
                <div class="col-sm-10">
                    <textarea asp-for="SpecificationViewModel.Text" class="form-control" rows="7" cols="60"></textarea>
                </div>
                <span asp-validation-for="SpecificationViewModel.Text" class="text-danger"></span>
            </div>
        </div>
    </div>

    <div class="card">
        <h5 class="card-header">ニュースソース</h5>
        <div class="card-body">
            <fieldset class="form-group">
                <div class="row">
                    <label asp-for="SpecificationViewModel.VideoSourceSelectItems" class="col-sm-2 col-form-label"></label>
                    <div class="col-sm-10">
                    @for(var i=0; i<Model.SpecificationViewModel.VideoSourceSelectItems.Count(); i++)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" asp-for="@Model.SpecificationViewModel.VideoSourceSelectItems[i].Selected"  />
                            <label class="form-check-label" asp-for="@Model.SpecificationViewModel.VideoSourceSelectItems[i].Selected">
                                @Model.SpecificationViewModel.VideoSourceSelectItems[i].Text
                            </label>
                            <input type="hidden" asp-for="@Model.SpecificationViewModel.VideoSourceSelectItems[i].Value" />
                            <input type="hidden" asp-for="@Model.SpecificationViewModel.VideoSourceSelectItems[i].Text" />                
                        </div>
                    }
                    </div>
                </div>
            </fieldset>
            <fieldset class="form-group">
                <div class="row">
                    <label asp-for="SpecificationViewModel.ArticleSourceSelectItems" class="col-sm-2 col-form-label"></label>
                    <div class="col-sm-10">
                    @for(var i=0; i<Model.SpecificationViewModel.ArticleSourceSelectItems.Count(); i++)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" asp-for="@Model.SpecificationViewModel.ArticleSourceSelectItems[i].Selected"  />
                            <label class="form-check-label" asp-for="@Model.SpecificationViewModel.ArticleSourceSelectItems[i].Selected">
                                @Model.SpecificationViewModel.ArticleSourceSelectItems[i].Text
                            </label>
                            <input type="hidden" asp-for="@Model.SpecificationViewModel.ArticleSourceSelectItems[i].Value" />
                            <input type="hidden" asp-for="@Model.SpecificationViewModel.ArticleSourceSelectItems[i].Text" />                
                        </div>
                    }
                    </div>
                </div>
            </fieldset>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">素材</label>
                <button id="add-material-button" type="button" class="btn btn-primary btn-sm">
                    <i class="fa fa-plus" aria-hidden="true"></i>&nbsp;追加
                </button>
            </div>
            <div id="materials">
                @await Html.PartialAsync("_MaterialSource", Model)
            </div>

        </div>
    </div>

    <div class="card">
        <h5 class="card-header">取材先</h5>
        <div class="card-body">
            <div class="form-group row">
                <button id="add-interview-button" type="button" class="btn btn-primary btn-sm">
                    <i class="fa fa-plus" aria-hidden="true"></i>&nbsp;追加
                </button>
            </div>
            <div id="interviews">
                @await Html.PartialAsync("_Interview", Model)
            </div>
        </div>
    </div>

    <div class="card">
        <h5 class="card-header">出演者</h5>
        <div class="card-body">
            <div class="form-group row">
                <button id="add-cast-button" type="button" class="btn btn-primary btn-sm">
                    <i class="fa fa-plus" aria-hidden="true"></i>&nbsp;追加
                </button>
            </div>
            <div id="casts">
                @await Html.PartialAsync("_Cast", Model)
            </div>
        </div>
    </div>

    <input type="hidden" asp-for="SpecificationViewModel.SpecificationId" />
    <div class="form-group">
        <input type="submit" value="Save" class="btn btn-primary" />
    </div>
</form>

<div>
    <a asp-page="/Schedules/Index">Back to List</a>
</div>


@section Scripts{
    <script>
        $("#add-material-button").on('click', function(){
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/AddMaterial',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#materials').html(partialView);
                }
            });
        });

        $("#materials").on('click', '.remove', function(){
            $(this).parents('tr').children(".dead-flag").val("true");
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/DeleteMaterial',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#materials').html(partialView);
                }
            });            
        });

        $("#add-interview-button").on('click', function(){
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/AddInterview',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#interviews').html(partialView);
                }
            });
        });

        $("#interviews").on('click', '.remove', function(){
            $(this).parents('tr').children(".dead-flag").val("true");
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/DeleteInterview',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#interviews').html(partialView);
                }
            });
        });

        $("#add-cast-button").on('click', function(){
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/AddCast',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#casts').html(partialView);
                }
            });
        });

        $("#casts").on('click', '.remove', function(){
            $(this).parents('tr').children(".dead-flag").val("true");
            $.ajax({
                type: 'POST',
                url: '/Specification/Edit/DeleteCast',
                data: $('form').serialize(),
                headers: {
                    RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(partialView){
                    $('#casts').html(partialView);
                }
            });            
        });      
    </script>
}